---
const allPosts = await Astro.glob("../../pages/blog/posts/*.md");

import Tag from "../ui/Tag.astro";
import ReadMore from "../ui/ReadMore.astro";
import Capsule from "../ui/Capsule.astro";
import DatePub from "./DatePub.astro";

// Get the latest post using reduce
const latestPost = allPosts.reduce((latest, current) => {
  const latestDate = new Date(latest.frontmatter.pubDate).getTime();
  const currentDate = new Date(current.frontmatter.pubDate).getTime();
  return currentDate > latestDate ? current : latest;
});

const tags = [...new Set(latestPost.frontmatter.tags ?? [])];
const languages = [...new Set(latestPost.frontmatter.languages ?? [])];
---

{
  latestPost && (
    <div
      class="h-full hover:shadow-[0_20px_50px_rgba(13,188,130,0.2)] flex flex-col overflow-hidden rounded-2xl bg-gradient-to-br from-zinc-900 via-zinc-800 to-zinc-900 transition-all ease-in-out duration-200 relative blog-post-card"
      role="article"
      aria-labelledby="post-title"
    >
      <div class="absolute inset-0 overflow-hidden rounded-2xl">
        <div class="swirl-effect"></div>
      </div>
      <article class="h-full flex flex-col justify-between p-8 max-md:p-6 relative z-10">
        <div
          class="w-full flex pb-5 gap-2 flex-wrap justify-end z-10 max-sm:px-6 max-sm:pt-6"
          role="list"
          aria-label="Programming languages"
        >
          {languages.map((language: unknown) => (
            <Capsule lang={language?.toString() || ""} />
          ))}
        </div>

        <a
          href={latestPost.url}
          class="text-mint-50 gap-3 h-full flex items-end max-sm:px-6  rounded-lg transition-all"
          aria-label={`Read article: ${latestPost.frontmatter.title}`}
        >
          <div class="gap-3 flex flex-col justify-end drop-shadow-[1px_6px_1px_rgba(0,0,0,0.3)]">
            <DatePub date={latestPost.frontmatter.pubDate} class="text-mint-50" />
            <h2
              id="post-title"
              class="text-4xl max-xl:text-3xl max-sm:text-2xl font-bold"
            >
              <span>{latestPost.frontmatter.title}</span>
            </h2>
            <ReadMore class="text-mint-50" />
          </div>
        </a>

        <div
          class="gap-2 mt-3 justify-start items-center flex flex-row flex-wrap max-sm:px-6 max-sm:pb-6"
          role="list"
          aria-label="Article tags"
        >
          {tags.map((tag) => (
            <Tag tag={tag} forceDark="true">{tag}</Tag>
          ))}
        </div>
      </article>
    </div>
  )
}

<style>
  .swirl-effect {
    position: absolute;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(0, 255, 204, 0.4) 0%, rgba(0, 212, 255, 0.3) 30%, transparent 70%);
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: swirl 8s ease-in-out infinite;
    filter: blur(40px);
  }

  @keyframes swirl {
    0%, 100% {
      transform: translate(-50%, -50%) rotate(0deg) scale(1);
      opacity: 0.6;
    }
    25% {
      transform: translate(-30%, -60%) rotate(90deg) scale(1.2);
      opacity: 0.8;
    }
    50% {
      transform: translate(-70%, -40%) rotate(180deg) scale(0.9);
      opacity: 0.7;
    }
    75% {
      transform: translate(-40%, -70%) rotate(270deg) scale(1.1);
      opacity: 0.9;
    }
  }

  .blog-post-card:hover .swirl-effect {
    animation-duration: 6s;
  }
</style>
